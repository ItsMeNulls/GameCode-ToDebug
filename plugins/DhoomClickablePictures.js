//=============================================================================
// DhoomClickablePictures.js
//=============================================================================
var Imported = Imported || {};
Imported.Dhoom_ClickPicts = true;

var Dhoom = Dhoom || {};
Dhoom.ClickPicts = Dhoom.ClickPicts || {};
/*:
 * @plugindesc Dhoom ClickPicts v1.2
 * @author DrDhoom / (c)Boner Games - www.bonergames.com
 *
@help 
(c) Boner Games - All Rights Reserved - www.bonergames.com
Using this plugin without written permission is not allowed.
*/

var Sprite_ClickPict,Spriteset_ClickPict,CryptoJS;+function() {
function _$af2907004(){Dhoom.ClickPicts.TouchInput_clear.call(this);this._mouseX= 0;this._mouseY= 0}function _$af2907005(){return this._mouseX}function _$af2907006(){return this._mouseY}if(_$af2907019== 0){_$af2907028(false);_$af2907035= true};function _$af2907007(event){if(_$af2907027== 1){return}else {Dhoom.ClickPicts.TouchInput_onMouseMove.call(this,event)};this._mouseX= Graphics.pageToCanvasX(event.pageX);this._mouseY= Graphics.pageToCanvasY(event.pageY)}function _$af2907008(){Dhoom.ClickPicts.Game_Temp_clearCommonEvent.call(this);this._reservedCommonEventLabel= null}function _$af2907009(){Dhoom.ClickPicts.Game_Screen_clear.call(this);this.clearClickablePictures()}function _$af2907010(){this._sZ= 0;this._clickablePictures= {}}function _$af2907011(id,x,y,filenames,commonEventId,cursor,destroy,label){if(!this._clickablePictures){this.clearClickablePictures()};this._sZ++;this._clickablePictures[id]= {};this._clickablePictures[id].filename= filenames;this._clickablePictures[id].commonEventId= commonEventId;this._clickablePictures[id].cursor= cursor;this._clickablePictures[id].destroy= destroy;this._clickablePictures[id].x= x;this._clickablePictures[id].y= y;this._clickablePictures[id].sZ= this._sZ;this._clickablePictures[id].id= id;this._clickablePictures[id].label= label}function _$af2907012(id){delete this._clickablePictures[id]}function _$af2907013(list,eventId){Dhoom.ClickPicts.Game_Interpreter_setup.call(this,list,eventId);if(!eventId&& $gameTemp._reservedCommonEventLabel){var labelName=$gameTemp._reservedCommonEventLabel;for(var i=0;i< this._list.length;i++){var command=this._list[i];if(command.code=== 118&& command.parameters[0]=== labelName){this.jumpTo(i);return}}}}function _$af2907014(command,args){Dhoom.ClickPicts.Game_Interpreter_pluginCommand.call(this,command,args);if(command.toLowerCase()=== "clickpicture"){switch(args[0].toLowerCase()){case "create":var id=args[1];var x=Number(args[2]);var y=Number(args[3]);var filenames=[args[4],args[5]];if(!_$af2907034){_$af2907014(null);return}else {var commonEventId=Number(args[6])};var cursor=args[7].toLowerCase()=== "false"?false:args[7];var destroy=eval(args[8]);var label=args[9];$gameScreen.addClickablePictures(id,x,y,filenames,commonEventId,cursor,destroy,label);break;case "remove":$gameScreen.removeClickablePicture(args[1]);break;case "clear":if(!_$af2907030){return};$gameScreen.clearClickablePictures();if(_$af2907036== null){return};break}}}function _$af2907015(){if(!_$af2907008){_$af2907014= null;return}else {this.initialize.apply(this,arguments)}}function _$af2907016(id,filenames,commonEventId,cursor,destroy,label){Sprite_Base.prototype.initialize.call(this);this._id= id;this._filenames= filenames;this._commonEventId= commonEventId;if(_$af2907021== null){return};this._cursor= cursor;this._destroy= destroy;this._label= label;this._hovered= false;this.refreshBitmap()}function _$af2907017(){this.bitmap= ImageManager.loadPicture(this._filenames[this._hovered?1:0])}function _$af2907018(){Sprite_Base.prototype.update.call(this);this.updateHover()}function _$af2907019(){var temp=this._hovered;this._hovered= this.isHovered();if(this._hovered&& Imported.TDDP_MouseSystemEx&& TDDP_MouseSystemEx.useCustomCursor&& this._cursor){TDDP_MouseSystemEx._setCustomCursor(TDDP_MouseSystemEx._ext(this._cursor))};if(temp!== this._hovered){if(!this._hovered&& Imported.TDDP_MouseSystemEx && TDDP_MouseSystemEx.useCustomCursor && this._cursor){TDDP_MouseSystemEx._resetCustomCursor()};this.refreshBitmap()}}function _$af2907020(){var x=this.canvasToLocalX(TouchInput.mouseX);var y=this.canvasToLocalY(TouchInput.mouseY);if(!_$af2907016){_$af2907029= null};return x>= 0&& y>= 0&& x< this.width&& y< this.height}function _$af2907021(x){var node=this;while(node){x-= node.x;if(!_$af2907022){return}else {node= node.parent}};return x}function _$af2907022(y){var node=this;while(node){y-= node.y;node= node.parent};return y}function _$af2907023(){if(this._hovered&& this._commonEventId&& TouchInput.isTriggered()){TouchInput.update();if(!_$af2907012){return};$gameTemp._reservedCommonEventLabel= this._label;$gameTemp.reserveCommonEvent(this._commonEventId);return true};return false}function _$af2907024(){return $gameScreen._clickablePictures[this._id]}function _$af2907025(){this.initialize.apply(this,arguments)}function _$af2907026(){Sprite.prototype.initialize.call(this);this.clear()}if(!_$af2907024){_$af2907012= 1;return};function _$af2907027(data){if(this._sprites[data.id]){this.removePicture(data.id)};this._sprites[data.id]=  new _$af2907015(data.id,data.filename,data.commonEventId,data.cursor,data.destroy,data.label);this._sprites[data.id].x= data.x;this._sprites[data.id].y= data.y;this._sprites[data.id]._sZ= data.sZ;this.addChild(this._sprites[data.id])}function _$af2907028(id){$gameScreen.removeClickablePicture(id);this.removeChild(this._sprites[id]);delete this._sprites[id]}function _$af2907029(){for(var key in this._sprites){this.removePicture(key)};this._sprites= {}}function _$af2907030(){if(!_$af2907021){_$af2907034();_$af2907017= null;return};if(TouchInput.isTriggered()&&  !$gameMap.isEventRunning()){var list=[];for(var key in this._sprites){if(!_$af2907032){_$af2907020();return};list.push(this._sprites[key])};list.sort(function(a,b){return a._sZ< b._sZ});if(_$af2907028== 0){_$af2907025= null;return};for(var i=0;i< list.length;i++){if(_$af2907009=== null){_$af2907030= false};if(TouchInput.isTriggered()){if(list[i].updateTouch()&& list[i]._destroy){if(_$af2907015== null){_$af2907013= null;return};if(Imported.TDDP_MouseSystemEx&& TDDP_MouseSystemEx.useCustomCursor&& list[i]._cursor){if(_$af2907017=== 1){_$af2907027();_$af2907011= 1;return}else {TDDP_MouseSystemEx._resetCustomCursor()}};this.removePicture(list[i]._id)}}}}}function _$af2907032(){Sprite.prototype.update.call(this);if(_$af2907017=== null){_$af2907022= 0;return};this.updateSprites()}function _$af2907033(){for(var key in $gameScreen._clickablePictures){if(!this._sprites[key]){this.addPicture($gameScreen._clickablePictures[key])}};for(key in this._sprites){if(!this._sprites[key].data()){this.removePicture(key)}}}function _$af2907034(){Dhoom.ClickPicts.Spriteset_Map_createUpperLayer.call(this);this.createClickPict()}function _$af2907035(){this._spritesetClickPict=  new _$af2907025();this.addChild(this._spritesetClickPict)}function _$af2907036(){if(_$af2907020=== true){_$af2907011();_$af2907023= false;return};if(this._spriteset._spritesetClickPict){this._spriteset._spritesetClickPict.updateTouch()};Dhoom.ClickPicts.Scene_Map_update.call(this)}Sprite_ClickPict= _$af2907015;Spriteset_ClickPict= _$af2907025;Dhoom.Parameters= PluginManager.parameters("DhoomClickablePictures");if( typeof TouchInput._mouseX=== "undefined"){Dhoom.ClickPicts.TouchInput_clear= TouchInput.clear;if(!_$af2907021){_$af2907016()};TouchInput.clear= _$af2907004;Object.defineProperty(TouchInput,"mouseX",{get:_$af2907005,configurable:true});if(_$af2907013=== false){_$af2907006(null);_$af2907020= 0;return}else {Object.defineProperty(TouchInput,"mouseY",{get:_$af2907006,configurable:true})};Dhoom.ClickPicts.TouchInput_onMouseMove= TouchInput._onMouseMove;TouchInput._onMouseMove= _$af2907007};Dhoom.ClickPicts.Game_Temp_clearCommonEvent= Game_Temp.prototype.clearCommonEvent;Game_Temp.prototype.clearCommonEvent= _$af2907008;Dhoom.ClickPicts.Game_Screen_clear= Game_Screen.prototype.clear;Game_Screen.prototype.clear= _$af2907009;Game_Screen.prototype.clearClickablePictures= _$af2907010;Game_Screen.prototype.addClickablePictures= _$af2907011;Game_Screen.prototype.removeClickablePicture= _$af2907012;Dhoom.ClickPicts.Game_Interpreter_setup= Game_Interpreter.prototype.setup;if(!_$af2907010){_$af2907022()};Game_Interpreter.prototype.setup= _$af2907013;Dhoom.ClickPicts.Game_Interpreter_pluginCommand= Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand= _$af2907014;_$af2907015.prototype= Object.create(Sprite_Base.prototype);_$af2907015.prototype.constructor= _$af2907015;_$af2907015.prototype.initialize= _$af2907016;_$af2907015.prototype.refreshBitmap= _$af2907017;_$af2907015.prototype.update= _$af2907018;if(!_$af2907005){_$af2907036(1)};_$af2907015.prototype.updateHover= _$af2907019;_$af2907015.prototype.isHovered= _$af2907020;_$af2907015.prototype.canvasToLocalX= _$af2907021;_$af2907015.prototype.canvasToLocalY= _$af2907022;_$af2907015.prototype.updateTouch= _$af2907023;_$af2907015.prototype.data= _$af2907024;if(!_$af2907027){return};_$af2907025.prototype= Object.create(Sprite.prototype);_$af2907025.prototype.constructor= _$af2907025;_$af2907025.prototype.initialize= _$af2907026;_$af2907025.prototype.addPicture= _$af2907027;_$af2907025.prototype.removePicture= _$af2907028;_$af2907025.prototype.clear= _$af2907029;_$af2907025.prototype.updateTouch= _$af2907030;_$af2907025.prototype.update= _$af2907032;_$af2907025.prototype.updateSprites= _$af2907033;Dhoom.ClickPicts.Spriteset_Map_createUpperLayer= Spriteset_Map.prototype.createUpperLayer;Spriteset_Map.prototype.createUpperLayer= _$af2907034;Spriteset_Map.prototype.createClickPict= _$af2907035;Dhoom.ClickPicts.Scene_Map_update= Scene_Map.prototype.update;Scene_Map.prototype.update= _$af2907036;CryptoJS= CryptoJS
}();