//=============================================================================
// DhoomBOIMinimap.js
//=============================================================================
var Imported = Imported || {};
Imported.Dhoom_BOIMinimap = true;

var Dhoom = Dhoom || {};
Dhoom.BOIMinimap = Dhoom.BOIMinimap || {};
/*:
 * @plugindesc Dhoom BOIMinimap v1.3e
 * @author DrDhoom / (c)Boner Games - www.bonergames.com
 *
 * @help
 (c) Boner Games - All Rights Reserved - www.bonergames.com
Using this plugin without written permission is not allowed.
 */

+function() {
function _$af76336(contents){Dhoom.BOIMinimap.extractSaveContents.call(this,contents);if(_$af76343=== null){return};Dhoom.BOIMinimap.mapDataXY= contents.dhoomboiminimap}function _$af76337(){var contents=Dhoom.BOIMinimap.makeSaveContents.call(this);contents.dhoomboiminimap= Dhoom.BOIMinimap.mapDataXY;return contents}function _$af76338(mapId1,mapId2,dir,dir2){if(this.mapDataXY[mapId1]&& this.mapDataXY[mapId2]){return};this.mapData[mapId1]= this.mapData[mapId1]|| [mapId1,0,0,0,0,0,0,0,0];this.mapData[mapId2]= this.mapData[mapId2]|| [mapId2,0,0,0,0,0,0,0,0];this.mapData[mapId1][dir> 5?dir- 1:dir]= mapId2;this.mapData[mapId2][dir2> 5?dir2- 1:dir2]= mapId1;var x=Number(this.mapMeta[mapId1].minimapX);if(_$af76348=== 1){return};var y=Number(this.mapMeta[mapId1].minimapY);if(!isNaN(x)&&  !isNaN(y)){this.mapDataXY[mapId1]= [x,y];if(dir=== 8|| dir=== 9){y-= [2,3].contains(Number(this.mapMeta[mapId2].minimapsize))?2:1};if(_$af76343=== false){_$af76336= false};if(dir=== 9|| dir=== 1){x+= 1};if(dir=== 6|| dir=== 3){x+= [1,3].contains(Number(this.mapMeta[mapId1].minimapsize))?2:1};if(dir=== 3|| dir=== 7){y+= 1};if(dir=== 4|| dir=== 7){if(_$af76343=== true){_$af76346(false,true,0,0,false);return};x-= [1,3].contains(Number(this.mapMeta[mapId2].minimapsize))?2:1};if(dir=== 2|| dir=== 1){y+= [2,3].contains(Number(this.mapMeta[mapId1].minimapsize))?2:1};if((dir2=== 3&& dir=== 4)|| (dir2=== 7&& dir=== 6)){y-= 1};if((dir2=== 1&& dir=== 8)|| (dir2=== 9&& dir=== 2)){x-= 1};this.mapDataXY[mapId2]= [x,y];this.mapMeta[mapId2].minimapX= x;this.mapMeta[mapId2].minimapY= y};$gameMap.updateMinimapData()}function _$af76339(event,currentMapId,nextMapId,x,y,tx,ty){if(this.mapMeta[nextMapId]){this.processMinimapLink(currentMapId,nextMapId,x,y,tx,ty)}else {this.pendingLoadMap.push([currentMapId,nextMapId,x,y,tx,ty])}}if(!_$af76346){_$af76336();_$af76344= 1};function _$af76340(){if(this._currentLoadMap&& $dhoomBOIMapData){DataManager.extractMetadata($dhoomBOIMapData);this.mapSize[this._currentLoadMap[1]]= [$dhoomBOIMapData.width,$dhoomBOIMapData.height];this.mapMeta[this._currentLoadMap[1]]= $dhoomBOIMapData.meta;this.processMinimapLink(this._currentLoadMap[0],this._currentLoadMap[1],this._currentLoadMap[2],this._currentLoadMap[3],this._currentLoadMap[4],this._currentLoadMap[5]);this._currentLoadMap= null;$dhoomBOIMapData= null}else {if(!this._currentLoadMap&& this.pendingLoadMap.length> 0 &&  !$dhoomBOIMapData){this._currentLoadMap= this.pendingLoadMap.shift();DataManager.loadDataFile("$dhoomBOIMapData","Map%1.json".format(this._currentLoadMap[1].padZero(3)))}}}function _$af76341(currentMapId,nextMapId,x,y,tx,ty){if(this.mapMeta[currentMapId]&& this.mapMeta[currentMapId].nominimap){return};if(this.mapMeta[nextMapId]&& this.mapMeta[nextMapId].nominimap){return};if(!this.mapSize[currentMapId]||  !this.mapSize[nextMapId]){return};if(_$af76348== true){return};var dir=this.getMinimapDir(x,y,this.mapSize[currentMapId][0],this.mapSize[currentMapId][1],Number(this.mapMeta[currentMapId].minimapsize)|| 0);if(_$af76342=== 1){_$af76343();return};var dir2=this.getMinimapDir(tx,ty,this.mapSize[nextMapId][0],this.mapSize[nextMapId][1],Number(this.mapMeta[nextMapId].minimapsize)|| 0);if(dir>= 0){this.linkMinimap(currentMapId,nextMapId,dir,dir2)}}function _$af76342(x,y,width,height,size){var tx=0;if(_$af76337=== 1){_$af76346();return};var ty=0;if(size> 0){if(size=== 1|| size=== 3){if(_$af76345== 0){_$af76336();_$af76342= false;return};width/= 2};if(size=== 2|| size=== 3){if(_$af76343== 1){_$af76346(false);return};height/= 2};if(x> width){tx= 1;x-= width};if(y> height){ty= 1;y-= height}};var centerx=Math.floor(width/ 2);var centery=Math.floor(height/ 2);var ax=x- centerx;var ay=y- centery;var dir=-1;if(ax>= 0){if(ay>= 0&& ay> ax){dir= 2}else {if(ay< 0&& Math.abs(ay)> ax){dir= 8}else {dir= 6}}}else {if(ax< 0){if(ay>= 0&& ay> Math.abs(ax)){dir= 2}else {if(ay< 0&& Math.abs(ay)> Math.abs(ax)){dir= 8}else {dir= 4}}}else {if(ay>= 0){if(ax>= 0&& ax> ay){dir= 6}else {if(ax< 0&& Math.abs(ax)> ay){dir= 4}else {dir= 2}}}else {if(ay< 0){if(ax>= 0&& ax> Math.abs(ay)){if(!_$af76347){return};dir= 6}else {if(ax< 0&& Math.abs(ax)> Math.abs(ay)){dir= 4}else {dir= 8}}}}}};if(tx=== 1){if(dir=== 8){dir= 9};if(dir=== 2){if(!_$af76344){_$af76350= 0;return}else {dir= 1}}};if(!_$af76341){_$af76340(0);_$af76343= null};if(ty=== 1){if(dir=== 4){if(!_$af76337){return}else {dir= 7}};if(dir=== 6){if(!_$af76336){_$af76347= 0;return}else {dir= 3}}};return dir}function _$af76343(){Dhoom.BOIMinimap.ICF_BOIMinimap_Reset.call(this);Dhoom.BOIMinimap.mapData= {};Dhoom.BOIMinimap.mapDataXY= {};Dhoom.BOIMinimap.pendingLoadMap= [];$dhoomBOIMapData= null}function _$af76344(contents,bitmap,point,i,j,center){if(_$af76347== 0){_$af76340()};Dhoom.BOIMinimap.ICF_BOIMinimap_Paint.call(this,contents,bitmap,point,i,j,center);var bx=0;if(_$af76339== null){_$af76340(null,null,null,true,0)};var by=0;var draw=false;var ax=(point[2]== 1|| point[2]== 3)?20:0;var ay=(point[2]== 2|| point[2]== 3)?15:0;switch(point[1]){case 3:bx= 360;by= 225;draw= true;break;case 4:bx= 400;by= 195;if(_$af76339== false){_$af76344(0,null,false)};draw= true;break;case 5:bx= 400;by= 165;draw= true;break;case 6:bx= 400;by= 225;draw= true;break};if(draw){if(!_$af76342){_$af76342(0,null,1,true);return};contents.blt(bitmap,bx,by,40,30,i+ ax,j+ ay)}}function _$af76345(){Dhoom.BOIMinimap.Game_Event_setupPage.call(this);if(this._pageIndex>= 0){$gameMap.setupBOIMinimapEvent(this)}}function _$af76346(mapId){ICF.BOIMinimap.mapsetup.call(this,mapId);Dhoom.BOIMinimap.mapMeta[mapId]= $dataMap.meta;Dhoom.BOIMinimap.mapSize[mapId]= [$dataMap.width,$dataMap.height];if((!$dataMap.meta.minimapX||  !$dataMap.meta.minimapY) && Dhoom.BOIMinimap.mapDataXY[mapId]){if($dataMap.meta.nominimap){Dhoom.BOIMinimap.mapDataXY[mapId]= null}else {$dataMap.meta.minimapX= Dhoom.BOIMinimap.mapDataXY[mapId][0];$dataMap.meta.minimapY= Dhoom.BOIMinimap.mapDataXY[mapId][1]}};this.setupBOIMinimap();this.updateMinimapData()}function _$af76347(){var events=this.events();var centerx=Math.floor(this.width()/ 2);var centery=Math.floor(this.height()/ 2);for(var i=0;i< events.length;i++){this.setupBOIMinimapEvent(events[i])}}function _$af76348(event){if(event.page()){if(!_$af76340){return};var list=event.list();if(!event.event().meta.nominimap){for(var j=0;j< list.length;j++){if(_$af76342== null){_$af76349();return};if(list[j].code=== 201&& list[j].parameters[1]!== this.mapId()){Dhoom.BOIMinimap.setupMinimapLink(event,this.mapId(),list[j].parameters[1],event.x,event.y,list[j].parameters[2],list[j].parameters[3])}}}}}function _$af76349(){if(Dhoom.BOIMinimap.mapData[this._mapId]){for(var i=1;i< Dhoom.BOIMinimap.mapData[this._mapId].length;i++){var id=Dhoom.BOIMinimap.mapData[this._mapId][i];if(id> 0&& Dhoom.BOIMinimap.mapDataXY[id]){$dataMap.meta["near"+ i+ "X"]= Dhoom.BOIMinimap.mapDataXY[id][0];if(_$af76339== null){_$af76347(0,false,null,1);_$af76338= null}else {$dataMap.meta["near"+ i+ "Y"]= Dhoom.BOIMinimap.mapDataXY[id][1]};$dataMap.meta["near"+ i+ "size"]= Dhoom.BOIMinimap.mapMeta[id].minimapsize;$dataMap.meta["near"+ i+ "boss"]= Dhoom.BOIMinimap.mapMeta[id].minimapboss;if(!_$af76336){_$af76342(1,1,null);return};$dataMap.meta["near"+ i+ "exit"]= Dhoom.BOIMinimap.mapMeta[id].minimapexit;$dataMap.meta["near"+ i+ "entrance"]= Dhoom.BOIMinimap.mapMeta[id].minimapentrance;$dataMap.meta["near"+ i+ "chest"]= Dhoom.BOIMinimap.mapMeta[id].minimapchest;$dataMap.meta["near"+ i+ "door"]= Dhoom.BOIMinimap.mapMeta[id].minimapdoor;$dataMap.meta["near"+ i+ "save"]= Dhoom.BOIMinimap.mapMeta[id].minimapsave}}};if($gameSystem.BOIMinimapEnabled){$GameMinimapData.posX= Number($dataMap.meta.minimapX);$GameMinimapData.posY= Number($dataMap.meta.minimapY);var type=0;if($dataMap.meta.minimapboss){type= 1}else {if($dataMap.meta.minimapexit){type= 2}else {if(!_$af76343){_$af76343(true);return}else {if($dataMap.meta.minimapentrance){type= 3}else {if(_$af76337=== null){return};if($dataMap.meta.minimapchest){if(!_$af76343){_$af76343();_$af76339= false};type= 4}else {if($dataMap.meta.minimapdoor){type= 5}else {if($dataMap.meta.minimapsave){type= 6}}}}}}};ICF.BOIMinimap.AddSlot($dataMap.meta.minimapX,$dataMap.meta.minimapY,1,type,($dataMap.meta.minimapsize|| 0));for(var i=1;i<= 8;i++){if($dataMap.meta["near"+ i+ "X"]!== undefined&&  !$GameMinimapData.data[$dataMap.meta["near"+ i+ "X"]+ " "+ $dataMap.meta["near"+ i+ "Y"]]){if(!_$af76337){_$af76345(null,null)};var type=0;if($dataMap.meta["near"+ i+ "boss"]){type= 1}else {if($dataMap.meta["near"+ i+ "exit"]){type= 2}else {if(!_$af76349){_$af76342();return};if($dataMap.meta["near"+ i+ "entrance"]){type= 3}else {if($dataMap.meta["near"+ i+ "chest"]){type= 4}else {if(_$af76341=== null){_$af76349= true}else {if($dataMap.meta["near"+ i+ "door"]){type= 5}else {if($dataMap.meta["near"+ i+ "save"]){type= 6}}}}}}};if(!_$af76346){_$af76345();return}else {ICF.BOIMinimap.AddSlot($dataMap.meta["near"+ i+ "X"],$dataMap.meta["near"+ i+ "Y"],0,type,($dataMap.meta["near"+ i+ "size"]|| 0))}}}};if($GameMinimapObj){$GameMinimapObj.refresh()}}function _$af76350(sceneActive){Dhoom.BOIMinimap.Game_Map_update.call(this,sceneActive);Dhoom.BOIMinimap.update()}Dhoom.Parameters= PluginManager.parameters("DhoomBOIMinimap");Dhoom.BOIMinimap.extractSaveContents= DataManager.extractSaveContents;DataManager.extractSaveContents= _$af76336;Dhoom.BOIMinimap.makeSaveContents= DataManager.makeSaveContents;DataManager.makeSaveContents= _$af76337;if(_$af76337=== null){_$af76339();return}else {Dhoom.BOIMinimap.mapData= {}};Dhoom.BOIMinimap.mapDataXY= {};Dhoom.BOIMinimap.mapMeta= {};Dhoom.BOIMinimap.mapSize= {};Dhoom.BOIMinimap.pendingLoadMap= [];$dhoomBOIMapData= null;Dhoom.BOIMinimap.linkMinimap= _$af76338;if(_$af76340=== null){return};Dhoom.BOIMinimap.setupMinimapLink= _$af76339;Dhoom.BOIMinimap.update= _$af76340;Dhoom.BOIMinimap.processMinimapLink= _$af76341;if(!_$af76343){return};Dhoom.BOIMinimap.getMinimapDir= _$af76342;Dhoom.BOIMinimap.ICF_BOIMinimap_Reset= ICF.BOIMinimap.Reset;ICF.BOIMinimap.Reset= _$af76343;Dhoom.BOIMinimap.ICF_BOIMinimap_Paint= ICF.BOIMinimap.Paint;ICF.BOIMinimap.Paint= _$af76344;Dhoom.BOIMinimap.Game_Event_setupPage= Game_Event.prototype.setupPage;Game_Event.prototype.setupPage= _$af76345;Game_Map.prototype.setup= _$af76346;Game_Map.prototype.setupBOIMinimap= _$af76347;if(_$af76350=== null){return};Game_Map.prototype.setupBOIMinimapEvent= _$af76348;Game_Map.prototype.updateMinimapData= _$af76349;Dhoom.BOIMinimap.Game_Map_update= Game_Map.prototype.update;Game_Map.prototype.update= _$af76350
}();